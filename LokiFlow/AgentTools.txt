A) Stage 1: Quick Health Check

Kullandığı http toolları ve parametreleri

MULTI-NAMESPACE SUPPORT: All queries analyze 12 production namespaces

1. Error Rate Check
sum(rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} | json | __error__="" | log_level="ERROR" [5m])) by (service_name, namespace)

2. Service Health Check
sum by (pod, namespace) (rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "ERROR|WARN|FATAL" [5m]))

3. Critical Errors Check
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "(FATAL|PANIC|fatal|panic)"


B) Anomaly Detection

Kullandığı http toolları ve parametreleri

1. Anomaly - Moving Average
rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |= "error"[1m])

2. Anomaly - Standard Deviation
rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "error" [1m])

3. Anomaly - Spike Detection
rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "error" [1m])

4. Anomaly - Rate Change
rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "error" [2m])


C) Stage 2: Pattern Analysis

Kullandığı http toolları ve parametreleri

1. Thread Correlation Analyzer
sum by (process_thread_name, service_name, namespace, error_type) (   count_over_time(     {namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"}      | json      | process_thread_name=~"taskScheduler-.*|Thread-.*"      | log_level="ERROR"      [1h]   ) )

2. Service Error Distribution
sum(rate({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "error" [1m])) by (service_name,pod,namespace)

3. Cascade Timeline Reconstructor
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} | json | __error__="" | log_level=~"ERROR|FATAL|WARN" | line_format "{{.timestamp}}|{{.namespace}}|{{.service_name}}|{{.process_thread_name}}|{{.error_type}}|{{.message}}" | limit 100

4. Request ID Correlation
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "trace_id|traceID|correlation_id" |~ "error" | limit 50

5. Error Pattern Analyzer
topk(20,   sum by (error, namespace) (     count_over_time(       {namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"}        |~ "error"        | json        | error!=""        [5m]     )   ) )


D) Stage 3: Root Cause Analysis

1. Stack Trace Pattern Analyzer
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} | json | error_stack_trace!="" | line_format "{{.namespace}}|||{{.service_name}}|||{{.error_type}}|||{{.error_stack_trace}}"|

2. Integration Health Monitor
sum by (target, namespace) (count_over_time({namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} | json | error_message=~".*(eca-t4|domain-config-t4).*401.*" | regexp "(?P<target>eca-t4|[a-zA-Z-]+-config-t4)" [5m]))

3. Slow Query Logs
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "(slow query|execution time).*(\\d{4,}ms|[2-9]\\d{3}ms)"

4. DB Connection Analysis
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod",pod=~".*db.*|.*database.*|.*mysql.*|.*postgres.*|.*mariadb.*"} |~ "connection|timeout|deadlock"

5. Memory Dump Analysis
{namespace=~"bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod"} |~ "OOM|OutOfMemory|memory limit|heap space"|

6. Pod Restart Logs
{job="kube-events"} |~ "namespace=~\"(bstp-cms-global-production|bstp-cms-prod-v3|em-global-prod-3pp|em-global-prod-eom|em-global-prod-flowe|em-global-prod|em-prod-3pp|em-prod-eom|em-prod-flowe|em-prod|etiyamobile-production|etiyamobile-prod)\"" |~ "Restarted|CrashLoopBackOff|OOMKilled"
 